<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">

  
    <meta name="description" content="为公主连接设计的开源聊天应答服务">
  

  
    <meta name="keywords" content="公主连接,公主连结,机器人,pcrbot">
  

  
    <meta name="author" content="pcrbot">
  

  

  

  <title>Linux 下部署一个公主连结 qq 群聊机器人 | pcrbot</title>

  

  
    <link rel="icon" href="/favicon.ico">
  

  

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head>
<body>
  <div class="root-container">
    <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          pcrbot
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">HOME</a></li>
        
          <li class="navbar-list-item"><a href="https://github.com/pcrbot" target="_blank" rel="noopener">GitHub</a></li>
        
          <li class="navbar-list-item"><a href="https://github.com/pcrbot/www.pcrbot.com/new/master/source/_posts/0?filename=new_post_name.md&value=---%0Atitle%3A+%E6%97%A0%E6%A0%87%E9%A2%98%0Aauthor%3A+%E6%9C%AA%E7%9F%A5%E4%BD%9C%E8%80%85%0A---%0A%0A%E5%9C%A8%E6%AD%A4%E4%BD%BF%E7%94%A8+markdown+%E7%BC%96%E5%86%99%E5%86%85%E5%AE%B9" target="_blank" rel="noopener">投稿</a></li>
        
      </ul>
    </div>
  </div>
</nav>

    
<!-- header container -->
<header class="header-container post">

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      
        <div class="post-image" style="background-image: url(/images/banner-little-lyrical.jpg)"></div>
      

      <div class="post-text">
        <div class="type-wrap">
          
        </div>
        <h1 class="title-wrap">Linux 下部署一个公主连结 qq 群聊机器人</h1>
        <h2 class="title-sub-wrap">
          <strong>地河君_official</strong>
          <span>发布于</span>
          
  <a href="javascript:;" class="article-date">
    <time datetime="2020-12-02T04:00:00.000Z" itemprop="datePublished">2020-12-02</time>
  </a>

        </h2>
      </div>
    </div>
  

  
  
  
</header>

    <!-- 文章 -->

<!-- 文章内容 -->

<div class="body-container">
  <article class="content-container article-container">
    <div class="article-content">
      
      

      <section class="article-entry">
        <h2 id="开篇"><a href="#开篇" class="headerlink" title="开篇"></a>开篇</h2><p>目前, 为公主连结玩家定制的 qq 群聊机器人 ( 以 <a href="https://github.com/pcrbot/yobot" target="_blank" rel="noopener">yobot</a> 和 <a href="https://github.com/Ice-Cirno/HoshinoBot" target="_blank" rel="noopener">HoshinoBot</a> 最具代表性 ) 已有非常多用户。它们可以提供一些诸如 公会战管理, 竞技场查询 等功能的应答, 为公主连结玩家提供了非常有用的帮助。</p>
<p>事实上, 这两个 bot 的代码均已开源, 任何人都可以自行搭建并根据自己的实际需要进行定制。</p>
<p>当然, 这需要你有一点基础, 你需要有</p>
<blockquote>
<ul>
<li>初中以上英语水平</li>
<li>熟悉搜索引擎 ( 单指谷歌 ) 的使用</li>
<li>基础的 shell 交互能力</li>
<li>git 基础知识</li>
<li>知道如何使用 vim 编辑器</li>
</ul>
</blockquote>
<p>( 注 : 以上能力按照重要性依次递减 )</p>
<p>若你具备以上能力 ( 至少掌握前两条 ) , 你就可以尝试部署一个机器人, 以便在你的群组中提供有趣或者实用的应答。</p>
<h3 id="为什么建议自己部署-bot"><a href="#为什么建议自己部署-bot" class="headerlink" title="为什么建议自己部署 bot"></a>为什么建议自己部署 bot</h3><p><strong><a href="https://github.com/pcrbot/yobot" target="_blank" rel="noopener">yobot</a> 和 <a href="https://github.com/Ice-Cirno/HoshinoBot" target="_blank" rel="noopener">HoshinoBot</a> 均以 <a href="http://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener">GPL 3.0</a> 协议开源。</strong></p>
<p>开源即是可以免费使用, 但开源不等同于免费, 开源让原本封闭的独裁的技术公开, 让更多的人有机会阅读源代码并从中学习, 包括源代码里面的思想、思路、亦或是实现方式。可以更容易发现 bug, 以及对开源项目提出改进意见, 进而使得一个开源项目更加完善。</p>
<hr>
<p>此处并非要求你一定要为社区贡献代码成为 Contributor, 你使用这些项目, 你和你公会的朋友就可以使用实用或者有趣的功能, bot 的作者 <a href="https://github.com/yuudi" target="_blank" rel="noopener">yuudi</a> 和 <a href="https://github.com/Ice-Cirno" target="_blank" rel="noopener">Ice-Cirno</a> 也会感到开心。</p>
<blockquote>
<p>Ice-Cirno : 我只是不想让我自己的代码帮别人数钱罢了。</p>
<p>我 : 可以建一个组织, 仓库仅组织可见。</p>
<p>Ice-Cirno : 挺麻烦的, 仓库早被 fork 无数次了。</p>
<p>我 : 或者在 README 里加上一句…</p>
<p>Ice-Cirno : 没意思, 都是防君子不防小人的。<br>嘛…只要想保持开放, 是阻止不了这种恰饭人的。<br>况且现在也无法转为封闭。<br></p>
<p>Ice-Cirno : 害, pcr 号一卖, repo 直接 archive<br>不盯着钱, 每天都能开开心心, 用 bot 转发画师、字幕组, 不香吗。<br>多投几篇论文，奖金不比这多 ?</p>
</blockquote>
<h3 id="预备"><a href="#预备" class="headerlink" title="预备"></a>预备</h3><p>本教程将会帮助你部署一个 bot , 如果你确定使用这个教程来部署 bot , 意味着你将使用以下项目的 源代码 / 二进制文件 :</p>
<ul>
<li><a href="https://github.com/pcrbot/yobot/" target="_blank" rel="noopener">yobot</a> </li>
<li><a href="https://github.com/Ice-Cirno/HoshinoBot/" target="_blank" rel="noopener">HoshinoBot</a> </li>
<li><a href="https://github.com/Mrs4s/go-cqhttp/" target="_blank" rel="noopener">go-cqhttp</a> </li>
<li><a href="https://github.com/Tsuk1ko/cq-picsearcher-bot/" target="_blank" rel="noopener">cq-picsearcher-bot</a> ( 可能 )</li>
</ul>
<p>请切勿忘记这一点。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>你需一台服务器, 服务器价格昂贵, 但你只是想用来部署机器人的话,你可以租用服务器厂商的 虚拟服务器 ( vps ) 。当前, 境内的服务器大厂多数有学生优惠, 你可以在完成学生验证之后以超实惠的价格买到一台虚拟服务器。如果你不是学生, <del>你可尝试去某宝当假学生。</del></p>
<p>目前境内大厂推出的活动 ( 例如学生优惠 / 开发者优惠 ) 都比较实惠, 尤其是某良心云 ( 自行在搜索 “ 良心云 “ ) 时不时出点香爆的活动, 可自行关注, 不要原价购买, <del><strong>除非你真的很有钱</strong></del>。</p>
<p><del>境外服务器推荐:</del></p>
<p>我也不知道, 我也想知道, 觉得好的请务必推荐给我。。</p>
<p>如果你实在不知道如何选择, 你可以尝试使用 <a href="https://tools.ipip.net/ping.php" target="_blank" rel="noopener">ipip.net 提供的 ping 功能</a> , ping 一下 mswifi.3g.qq.com , 然后按响应时间排序, 在 ping 的地点那一列能看到服务器的提供商, 优先选择 ping 值低的提供商。</p>
<h3 id="选择服务器的系统镜像"><a href="#选择服务器的系统镜像" class="headerlink" title="选择服务器的系统镜像"></a>选择服务器的系统镜像</h3><p>本教程测试环境是 CentOS 7.6 和 Ubuntu 18.04 , 未在 Debian 上进行测试, 理论上和 Ubuntu 应该一样。<br>因此我建议你使用 CentOS 7.* 或者 Ubuntu 18.04 ( 20.04 也可行) 。</p>
<h2 id="开始部署"><a href="#开始部署" class="headerlink" title="开始部署"></a>开始部署</h2><p>第一步, 你需要连接上你的服务器, 本教程指令均不出现 <code>sudo</code> , 为了不出现  <code>Permission denied</code> 的错误, 请直接在 root 账户执行指令。</p>
<blockquote>
<p>root 账户是 Linux 系统 ( 或者说是 Unix 亦或是类 Unix 系统 ) 超级管理员账户, 权限大于 Windows 系统中的 <code>Administrator</code> 账户, 如果操作不当, 对服务器来说是非常危险的, 有经验的 Linux 用户会建议你新建一个低权限账户减少发生意外时的损失。</p>
</blockquote>
<p>相信我, 只要不用 root 账户进行不当操作, 那应该是没问题的… ( 大概 )</p>
<p>本教程默认你使用的是 root 账户, 你也可以创建一个低权限账户并在每个指令前加上 <code>sudo</code> 完成部署。</p>
<h3 id="安装运行所需环境"><a href="#安装运行所需环境" class="headerlink" title="安装运行所需环境"></a>安装运行所需环境</h3><p>下列指令请一条一条复制, 一段一段复制可能会出现问题。</p>
<p>注 : 此处是为了防止编译时发生错误。</p>
<pre class=" language-shell"><code class="language-shell"># CentOS 用户请执行
yum -y update
yum -y groupinstall "Development tools"
yum -y install wget zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc* libffi-devel make git vim screen
# 如果你正在使用 ARM 架构的服务器, 请额外执行 yum -y install xz-devel
# 如果你不明白上面这句话, 直接无视掉

# Debian 、Ubuntu 用户请执行
apt -y update
apt -y install build-essential
apt -y install -y make libssl-dev zlib1g-dev libbz2-dev libpcre3 libpcre3-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libperl-dev libncursesw5-dev xz-utils tk-dev zlib1g libffi-dev liblzma-dev screen git vim openssl gcc
# 如果你正在使用 ARM 架构的服务器, 请额外执行 apt -y install liblzma-dev
# 如果你不明白上面这句话, 直接无视掉</code></pre>
<h3 id="安装-Python3-9"><a href="#安装-Python3-9" class="headerlink" title="安装 Python3.9"></a>安装 Python3.9</h3><p>Python 3.9 通过测试。</p>
<pre class=" language-shell"><code class="language-shell">wget https://www.python.org/ftp/python/3.9.5/Python-3.9.5.tgz
# 下载 Python 源代码
# 国内源 : https://mirrors.huaweicloud.com/python/3.9.5/Python-3.9.5.tgz

tar xf Python-3.9.5.tgz
# 解压

cd Python-3.9.5
# 进入这个文件夹

# ↓↓↓ CentOS 用户请执行 ↓↓↓
./configure
# ↑↑↑ Ubuntu 和 Debian 用户请无视 ↑↑↑ 
# 编译检查, 生成 Makefile

# ↓↓↓ Ubuntu 和 Debian 用户请执行 ↓↓↓
./configure  --enable-optimizations
# ↑↑↑ CentOS 用户请无视 ↑↑↑ 
# 编译检查, 生成 Makefile

make&&make install
# 编译安装

pip3 install --upgrade pip
# 境内机器可以加上 -i https://pypi.tuna.tsinghua.edu.cn/simple/ 这个参数加快下载速度</code></pre>
<p><code>--enable-optimizations</code> 是 Python 编译优化的参数, 编译检查时加上这个参数大约能给 Python 带来 10% 的性能优化。<br>如果 <code>gcc编译器</code> 版本低于 <code>5.4.0</code> , 那么加上这个参数会使 Python 编译失败, CentOS 自带的包管理工具 <code>yum</code> 不能帮你安装 <code>5.4.0</code> 以上的版本, <del>Ubuntu 或者 Debian 的 <code>apt</code> 却可以。</del></p>
<p>你也可以自行为你的 CentOS 服务器升级 <code>gcc编译器</code> , 在编译 gcc编译器 的时候需要大量时间, 你可自行借助搜索引擎尝试。</p>
<h3 id="获取-go-cqhttp"><a href="#获取-go-cqhttp" class="headerlink" title="获取 go-cqhttp"></a>获取 go-cqhttp</h3><p>go-cqhttp 是使用 go 语言对 cqhttp 协议重新实现, 并实现了很多原版 cq-http 没有实现的 api 。</p>
<pre class=" language-shell"><code class="language-shell">cd
# 进入到用户文件夹

mkdir go-cqhttp&&cd go-cqhttp
# 创建 go-cqhttp 文件夹并将工作路径切换到这个文件夹

wget https://github.com/Mrs4s/go-cqhttp/releases/download/v1.0.0-beta4/go-cqhttp_linux_amd64.tar.gz
# 可使用 github 镜像站提高境内服务器下载 github 文件的速度
# 例如 hub.fastgit.com, github.dihe.moe
# 下载 go-cqhttp

tar xf go-cqhttp_linux_amd64.tar.gz
# 解压

chmod +x go-cqhttp
# 给 go-cqhttp 执行权限

./go-cqhttp
# 首次运行 go-cqhttp , 在当前目录下生成配置文件 config.yml</code></pre>
<h3 id="go-cqhttp-的配置文件"><a href="#go-cqhttp-的配置文件" class="headerlink" title="go-cqhttp 的配置文件"></a>go-cqhttp 的配置文件</h3><p>config.yml:</p>
<p>请先填写好要作为机器人登录的账号, <strong>暂先不填密码。</strong></p>
<p>配置文件有详细注释, 此处省略。</p>
<p>成功登录后还会生成一个名为 device.json 的文件, 它保存的是登陆设备的信息 :</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"protocol"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> // 设备种类<span class="token punctuation">,</span> 值为 <span class="token number">0</span> 代表 iPad<span class="token punctuation">,</span> 值为 <span class="token number">1</span> 代表 Android 手机<span class="token punctuation">,</span> 值为 <span class="token number">2</span> 代表 Android 手表
    <span class="token property">"display"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> // 无需考虑的配置项
    <span class="token property">"finger_print"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> // 无需考虑的配置项
    <span class="token property">"boot_id"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> // 无需考虑的配置项
    <span class="token property">"proc_version"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> // 无需考虑的配置项
    <span class="token property">"imei"</span><span class="token operator">:</span> <span class="token string">"xxx"</span> // 无需考虑的配置项
<span class="token punctuation">}</span></code></pre>
<p>当设备种类设定为 iPad 时, 功能无限制。此时, 用于部署 bot 的账号不能在别的设备上用 QQ HD 登录。<br><del>呜呜呜, 年轻人的第一台 iPad。</del></p>
<p>当设备种类设定为 iPhone 手机 时, 功能无限制。此时, 用于部署 bot 的账号不能在别的设备上用手机 QQ 登录。</p>
<p>当设备种类设定为 Android 手表 时, bot 无法接收 <code>group_notify</code> 事件、无法接收口令红包信息, 也无法收取消息撤回时间。</p>
<h3 id="配置-go-cqhttp-反向-ws-配置"><a href="#配置-go-cqhttp-反向-ws-配置" class="headerlink" title="配置 go-cqhttp 反向 ws 配置"></a>配置 go-cqhttp 反向 ws 配置</h3><p>由于 Hoshino 使用反向 websocket 与 go-cqhttp 通信, 所以我们应该对配置文件中的反向 websocket 部分进行配置。</p>
<p>两种示例, 两种都是正确的, 随便选一种就可以。</p>
<p>以 HoshinoBot 为例, HoshinoBot 的默认端口是 <code>8080</code> , 因此 go-cqhttp 的反向 ws 上报地址应为 <code>ws://127.0.0.1:8080/ws/</code> 。</p>
<p>你可以使用 vim 编辑器编辑配置文件 :</p>
<pre class=" language-shell"><code class="language-shell">vim config.yml
# 不了解 vim 编辑器的速速去了解先</code></pre>
<p>找到 <code>servers</code> 部分, 将其修改为 :</p>
<pre class=" language-yml"><code class="language-yml">servers:
  - ws-reverse:
      universal: ws://127.0.0.1:8080/ws/
      api: ''
      event: ''
      reconnect-interval: 3000
      middlewares:
        <<: *default</code></pre>
<p>或者 :</p>
<pre class=" language-yml"><code class="language-yml">servers:
  - ws-reverse:
      universal: ''
      api: ws://127.0.0.1:8080/ws/api/
      event: ws://127.0.0.1:8080/ws/event/
      reconnect-interval: 3000
      middlewares:
        <<: *default</code></pre>
<p>两种都是正确的, 任意一种即可。</p>
<p>然后退出 vim 编辑器。</p>
<h3 id="获取-HoshinoBot"><a href="#获取-HoshinoBot" class="headerlink" title="获取 HoshinoBot"></a>获取 HoshinoBot</h3><p>重头戏来了。</p>
<pre class=" language-shell"><code class="language-shell">cd
# 进入到用户文件夹

mkdir pcrbot
# 创建一个文件夹

cd pcrbot
# 将工作路径切换到这个文件夹

git clone https://github.com/Ice-Cirno/HoshinoBot.git
# clone 仓库</code></pre>
<p>关于安装依赖 :</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 方法一: 使用 poetry ( 推荐 )</span>
pip3 <span class="token function">install</span> poetry
<span class="token comment" spellcheck="true"># 安装 poetry</span>

<span class="token function">wget</span> https://pan.dihe.moe/pyproject.toml
<span class="token comment" spellcheck="true"># 这是一份写好了的 pyproject.toml</span>

poetry <span class="token function">install</span>
<span class="token comment" spellcheck="true"># 等待, 并心存希望吧</span>

<span class="token comment" spellcheck="true"># 方法二: 直接使用 pip</span>
pip3 <span class="token function">install</span> -r https://pan.dihe.moe/requirements.txt
<span class="token comment" spellcheck="true"># 可在这个指令后加上 -i http://mirrors.aliyun.com/pypi/simple/ 切换到国内源</span></code></pre>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> HoshinoBot
<span class="token comment" spellcheck="true"># 切换到 HoshinoBot 目录</span>

<span class="token function">cp</span> -r hoshino/config_example hoshino/config
<span class="token comment" spellcheck="true"># 复制配置文件示例</span>

vim hoshino/config/__bot__.py
<span class="token comment" spellcheck="true"># 修改配置项以自定义你的机器人, 按照中文注释填好。</span></code></pre>
<p>若你的服务器有中文乱码的现象, 你可以对照 <a href="https://github.com/Ice-Cirno/HoshinoBot/blob/master/hoshino/config_example/__bot__.py" target="_blank" rel="noopener">这里</a> 的中文注释修改你的配置。</p>
<h3 id="获取静态资源"><a href="#获取静态资源" class="headerlink" title="获取静态资源"></a>获取静态资源</h3><p>获取合成图片所需要的图包  :</p>
<pre class=" language-shell"><code class="language-shell">cd ~/pcrbot/HoshinoBot
# 切换工作路径

wget https://pan.dihe.moe/res.tar.gz
# 下载静态资源

tar xf res.tar.gz
# 解压静态资源</code></pre>
<p>安装新版 jjc 查询合成图片所需要的字体 :</p>
<pre class=" language-shell"><code class="language-shell"># ↓↓↓ CentOS 执行 ↓↓↓
yum -y install fontconfig

#↓↓↓ Ubuntu 和 Debian 执行 ↓↓↓
apt -y install fontconfig

mkdir -p /usr/share/fonts/chinese
# 创建字体文件夹

wget https://pan.dihe.moe/msyh.tar.gz
# 下载字体

tar zxvf msyh.tar.gz -C /usr/share/fonts/chinese
# 解压到字体目录

mkfontscale
mkfontdir
# 创建字体缓存</code></pre>
<h3 id="测试-bot-是否搭建成功"><a href="#测试-bot-是否搭建成功" class="headerlink" title="测试 bot 是否搭建成功"></a>测试 bot 是否搭建成功</h3><p>尝试运行 bot , 看看其是否能工作。</p>
<p>1, 启动 <code>go-cqhttp</code> :</p>
<pre class=" language-shell"><code class="language-shell">screen -S go-cqhttp
# 创建一个新的窗口用于运行 go-cqhttp 

cd ~/go-cqhttp

./go-cqhttp
# 运行 go-cqhttp 

# 需要扫码验证登录, 需要先在移动端登录你在配置文件中填写的 bot 的 qq 账号, 然后扫码

# 有极低概率获取到无效的登陆地址而导致登陆失败, 重试即可解决

# 成功登陆后, go-cqhttp 会尝试连接到 Websocket Universal 服务器 ws://127.0.0.1:8080/ws/ 
# 此时应该会提示链接出错 ( 因为 HoshinoBot 还没有运行 ), 暂先不管, 直接使用组合键 Ctrl + a ,d 挂起这个窗口</code></pre>
<p>2, 启动 <code>HoshinoBot</code> :</p>
<pre class=" language-shell"><code class="language-shell">screen -S hoshino
#创建一个新的窗口用于运行 HoshinoBot

cd ~/pcrbot/HoshinoBot
# 切换工作路径

# 运行 Hoshino:
# ↓↓↓ 使用了 poetry 的场合 ↓↓↓
poetry run python run.py

# ↓↓↓ 直接使用 pip 的场合 ↓↓↓
python3 run.py</code></pre>
<p>如果到这里为止一切正常, HoshinoBot 的控制台应该会输出类似于这样的一条日志 :</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token punctuation">[</span><span class="token datetime number">2020-09-21 22:30:45</span><span class="token punctuation">,</span><span class="token number">435</span><span class="token punctuation">]</span> 127.0.0.1<span class="token punctuation">:</span>56363 GET /ws/ 1.1 101 <span class="token punctuation">-</span> <span class="token number">114514</span></code></pre>
<p>然后, 使用组合键 Ctrl + a ,d 挂起这个窗口。</p>
<p>恭喜 ! 你成功搭建了 HoshinoBot , 现在立刻在群里 艾特 你的 bot 并发送一句 <code>kkp</code> 吧 !</p>
<h3 id="解决-Hoshino-启动时的-Warning"><a href="#解决-Hoshino-启动时的-Warning" class="headerlink" title="解决 Hoshino 启动时的 Warning"></a>解决 Hoshino 启动时的 Warning</h3><p>你启动的时候看到诸如此类的警告信息:</p>
<pre class=" language-yml"><code class="language-yml">[2021-06-11 00:38:55,020 config] WARNING: Not found config of "xxx"</code></pre>
<p>你可以无视掉它, 不解决这个问题不会有任何影响, 但下一次启动时你仍然会看到这个警告。</p>
<p>这个警告的字面意思是没有找到某个模块的配置文件, 在 HoshinoBot 的 config 文件夹创建对应模块的空配置文件即可。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">touch</span> ~/pcrbot/HoshinoBot/hoshino/config/xxx.py</code></pre>
<p>xxx 替换成你在控制台看到的, 缺少配置文件的模块。</p>
<h3 id="Hoshino-的-api-key"><a href="#Hoshino-的-api-key" class="headerlink" title="Hoshino 的 api key"></a>Hoshino 的 api key</h3><p>Hoshino 部分功能需要填写 apikey 后才可使用。</p>
<h4 id="Mikan-RSS-token"><a href="#Mikan-RSS-token" class="headerlink" title="Mikan RSS token"></a>Mikan RSS token</h4><p>使用 HoshinoBot 的番剧推送功能需要 Mikan 的 rss token,</p>
<p>你可以在 mikan 注册账号之后, 在 <a href="https://mikanani.me/" target="_blank" rel="noopener">这个页面</a> 鼠标右键点击 RSS 订阅 的图标, 点击 复制链接地址, 然后得到这样一条地址</p>
<p><code>https://mikanani.me/RSS/MyBangumi?token=abcdfegABCFEFG%2b123%3d%3d</code></p>
<p>将其 token 部分的 <code>%2b</code>替换为<code>+</code> , 将 <code>%2f</code> 替换为 <code>/</code> , 将 <code>%3d</code>替换为 <code>=</code> 后, 得到这样的一个字符串 : <code>abcdfegABCFEFG%2b123==</code> , 这就是你的 rss token。</p>
<pre class=" language-shell"><code class="language-shell">vim ~/pcrbot/HoshinoBot/hoshino/config/mikan.py</code></pre>
<p>将它填写到 <code>mikan.py</code> 吧。</p>
<h4 id="报时文本"><a href="#报时文本" class="headerlink" title="报时文本"></a>报时文本</h4><p>编写报时文本是个体力活, 你可以使用别人编写好了的, </p>
<pre class=" language-shell"><code class="language-shell">cd ~/pcrbot/HoshinoBot/hoshino/config
# 切换工作路径

rm -f hourcall.py
# 删除空配置文件

wget https://pan.dihe.moe/hourcall.py
# 下载报时文本</code></pre>
<h4 id="推特转发"><a href="#推特转发" class="headerlink" title="推特转发"></a>推特转发</h4><p>需推特开发者账号, 可在 <a href="https://developer.twitter.com/en" target="_blank" rel="noopener">这里</a> 申请, 一旦失败, 此账号将永久失去再次申请的资格。来自中国大陆的申请大概率不通过, 请使用海外手机号提高通过概率。</p>
<p><strong>注意 : 使用 Google Voice 等虚拟手机号极高概率会使推特账号永久封禁。</strong></p>
<p>如果你已经具有推特开发者账号, 你可以在 <a href="https://developer.twitter.com/en/portal/apps/new" target="_blank" rel="noopener">这里</a> 创建一个应用, 取得应用的 <code>consumer_key</code> , <code>consumer_secret</code> , <code>access_token_key</code> , <code>access_token_secret</code> 四个参数, 并将其填入配置文件的 <code>twitter.py</code> 。</p>
<pre class=" language-shell"><code class="language-shell">vim ~/pcrbot/HoshinoBot/hoshino/config/twitter.py</code></pre>
<h4 id="pcrdfans-的授权-key"><a href="#pcrdfans-的授权-key" class="headerlink" title="pcrdfans 的授权 key"></a>pcrdfans 的授权 key</h4><p>使用 pcrdfans 提供的 jjc 查询功能需要 pcrdfans 的授权 key 。</p>
<p>你可以在 <a href="https://pcrdfans.com/bot" target="_blank" rel="noopener">https://pcrdfans.com/bot</a> 申请。现在申请渠道已关闭。</p>
<p>如果你已经有了授权 key , 你可以把它填到配置文件的 priconne.py 去。</p>
<pre class=" language-shell"><code class="language-shell">vim ~/pcrbot/HoshinoBot/hoshino/config/priconne.py</code></pre>
<h4 id="设置入群欢迎"><a href="#设置入群欢迎" class="headerlink" title="设置入群欢迎"></a>设置入群欢迎</h4><pre class=" language-shell"><code class="language-shell">vim ~/pcrbot/HoshinoBot/hoshino/config/groupmaster.py</code></pre>
<p>在 <code>increase_welcome</code> 中按照这样的格式填写 :</p>
<pre class=" language-json"><code class="language-json">increase_welcome = <span class="token punctuation">{</span>
    <span class="token property">"default"</span><span class="token operator">:</span> <span class="token string">"欢迎入群 ! 你已经是群大佬了, 快来跟群萌新打个招呼吧 ~"</span><span class="token punctuation">,</span>
    <span class="token number">367501912</span><span class="token operator">:</span> <span class="token string">"欢迎来到 Hoshino 群 !"</span><span class="token punctuation">,</span>
    <span class="token number">770947581</span><span class="token operator">:</span> <span class="token string">"欢迎来到 yobot 1 群 !"</span><span class="token punctuation">,</span>
    <span class="token number">1044314369</span><span class="token operator">:</span> <span class="token string">"欢迎来到 yobot 2 群 !"</span><span class="token punctuation">,</span>
    <span class="token number">774394459</span><span class="token operator">:</span> <span class="token string">"欢迎来到 yobot 5 群 !"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="获取-yobot"><a href="#获取-yobot" class="headerlink" title="获取 yobot"></a>获取 yobot</h3><p>两种安装 yobot 的方法。这里只写一种。<br>第二种安装方法在未来将不被支持。<del>懂的都懂。</del></p>
<h4 id="源码运行"><a href="#源码运行" class="headerlink" title="源码运行"></a>源码运行</h4><p>首先修改 go-cqhttp 的示例并重启, 使其同时向 <code>ws://127.0.0.1:8080/ws/</code> 和 <code>ws://127.0.0.1:9222/ws/</code> 上报事件, 下面的配置文件可供参考 :</p>
<pre class=" language-json"><code class="language-json">servers<span class="token operator">:</span>
  - ws-reverse<span class="token operator">:</span>
      universal<span class="token operator">:</span> ws<span class="token operator">:</span>//<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">8080</span>/ws/
      api<span class="token operator">:</span> ''
      event<span class="token operator">:</span> ''
      reconnect-interval<span class="token operator">:</span> <span class="token number">3000</span>
      middlewares<span class="token operator">:</span>
        &lt;&lt;<span class="token operator">:</span> *default
  - ws-reverse<span class="token operator">:</span>
      universal<span class="token operator">:</span> ws<span class="token operator">:</span>//<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">9222</span>/ws/
      api<span class="token operator">:</span> ''
      event<span class="token operator">:</span> ''
      reconnect-interval<span class="token operator">:</span> <span class="token number">3000</span>
      middlewares<span class="token operator">:</span>
        &lt;&lt;<span class="token operator">:</span> *default</code></pre>
<p>获取 yobot :</p>
<pre class=" language-shell"><code class="language-shell">cd ~/pcrbot
# 切换工作路径到 pcrbot 文件夹

git clone https://github.com/yuudi/yobot.git
# clone 仓库

cd yobot/src/client
# 切换工作路径

screen -S yobot
# 创建一个新窗口用于运行 yobot </code></pre>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 使用了 poetry 的场合:</span>
poetry run python main.py
<span class="token comment" spellcheck="true"># 生成 yobotg.sh</span>

vim yobotg.sh
<span class="token comment" spellcheck="true"># 修改 yobotg.sh 的第七行的 python3 main.py -g 为 poetry run python main.py -g</span>

sh yobotg.sh
<span class="token comment" spellcheck="true"># 启动 yobot</span>

<span class="token comment" spellcheck="true"># 直接使用 pip 的场合:</span>
python3 main.py

sh yobotg.sh</code></pre>
<p>然后, 使用组合键 Ctrl + a , d 挂起这个窗口</p>
<p>私聊或群聊发送 <code>V</code> 或 <code>ver</code> 或 <code>version</code> , bot 会回复 yobot 版本。</p>
<p>放通端口, 使 yobot 的 web 能在 9222 端口被外部访问 :</p>
<pre class=" language-shell"><code class="language-shell">firewall-cmd --zone=public --add-port=9222/tcp --permanent
firewall-cmd --reload
# 针对 CentOS 用户, Ubuntu 和 Debian 无需执行。</code></pre>
<p>如果你是在大厂租用的服务器, 你的服务器商通常给你的服务器自带了防火墙, 服务器商不同, 开启方法也不相同, 你需要自行去服务商的服务器管理面板放通 9222 端口, 如果你不知道怎么操作, 你可以去谷歌搜索 &lt;你的服务器商的名字&gt; + 放通端口 。</p>
<p>验证 : </p>
<p>手机或者电脑访问 <code>http://服务器 ip :9222/</code> , 能打开就算搭建成功。</p>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>设置反向代理的一个好处是可以为你的 yobot 的 web 引入 https 支持, https 协议可以通过 ssl 提供加密处理数据、验证对方身份以及数据完整性保护, 是一种安全的传输协议。</p>
<p>使用反向代理需确定自己有一个域名, 并将域名解析到服务器。</p>
<p>由中国大陆有特殊的法律, 你的服务器在中国大陆境内且使用的域名未通过备案的话, 你是无法使用 80 或者 443 端口的, 这将造成你的 web 无法被访问。唯二解决方法, 一是先去 <a href="https://www.baidu.com/s?ie=utf-8&f=8&rsv_bp=1&rsv_idx=1&tn=baidu&wd=%E5%9F%9F%E5%90%8D%E5%A4%87%E6%A1%88&fenlei=256&rsv_pq=af08bb33000fc69a&rsv_t=a9b5UmKd%2Fb7J%2FVFVWR7aK3g9nN6PanIhYZ%2Bf5%2FQxGgXMYmVKdxM%2FOyYfSiE&rqlang=cn&rsv_enter=1&rsv_dl=tb&rsv_sug3=14&rsv_sug1=11&rsv_sug7=101&rsv_sug2=0&rsv_btype=i&prefixsug=%25E5%259F%259F%25E5%2590%258D%25E5%25A4%2587%25E6%25A1%2588&rsp=4&inputT=3390&rsv_sug4=3972" target="_blank" rel="noopener">备案</a> , 二是使用境外服务器部署。</p>
<p><strong>注意 : 有些域名无法备案, 购买域名之前应该先去了解。</strong></p>
<p>如果你想要保护隐私, <del>那么你应该拒绝国内云</del>。</p>
<p>下面开始介绍使用 <a href="https://nginx.org/" target="_blank" rel="noopener">nginx</a> 将在 <code>9222</code> 或 <code>8080</code> 端口运行的 yobot 的 web 转发到 80 端口。</p>
<p>假设你购买了域名, 你可以添加一条 A 记录到你的服务器, 如果你不知道怎么加, <a href="https://www.google.com.hk/webhp?hl=zh-CN&sourceid=cnhp&gws_rd=ssl" target="_blank" rel="noopener">Google</a> will help you.</p>
<p>当你在命令行输入 <code>nslookup example.com</code> ( 其中 example.com 为你自己解析到服务器的域名 ) 并在 <code>address</code> 行看到了你服务器的公网 ip 时, 你就成功的设置好了解析。</p>
<h4 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h4><p>目前的 stable 版是 1.18.0, 本教程就以 1.18.0 为例。<br>无论何时我都建议你下载 stable 版, 你可以在 <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener">这里</a> 查看当前的 stable 版。</p>
<pre class=" language-shell"><code class="language-shell">cd
# 切换工作路径到用户文件夹

wget http://nginx.org/download/nginx-1.18.0.tar.gz
# 下载 nginx
# 国内源 : https://cn-pan.di.he.cn/Linux/nginx-1.18.0.tar.gz

tar xf nginx-1.18.0.tar.gz
# 解压

cd nginx-1.18.0
# 切换工作路径

./configure --with-http_ssl_module --with-http_v2_module
# 编译检查, 生成 MakeFile , 启用 ssl 模块和 http2 模块
# 如果没有加上这两个参数, 就无法引入 https 支持。

make&&make install
# 编译安装</code></pre>
<h4 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h4><pre class=" language-shell"><code class="language-shell">cd /usr/local/nginx/sbin
# 切换工作路径

./nginx
# 启动 nginx

curl 127.0.0.1
# 向 127.0.0.1 发出 GET 请求, 返回结果会输出在命令行</code></pre>
<p>此处应输出 nginx 的欢迎页面。</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>将 nginx 加入环境变量以简化后续操作</p>
<pre class=" language-shell"><code class="language-shell">vim /etc/profile</code></pre>
<p>在这个文件的结尾填入</p>
<pre class=" language-nginx"><code class="language-nginx">export NGINX_HOME<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx
export PATH<span class="token operator">=</span><span class="token variable">$PATH</span><span class="token punctuation">:</span><span class="token variable">$NGINX_HOME</span><span class="token operator">/</span>sbin</code></pre>
<p>退出 vim 编辑器, 使用 <code>source /etc/profile</code> 使其生效。</p>
<p>验证 :</p>
<pre class=" language-shell"><code class="language-shell">firewall-cmd --zone=public --add-port=80/tcp --permanent
firewall-cmd --reload
# 放通 80 端口</code></pre>
<p>然后, 使用你的手机或者电脑的浏览器, 输入你的域名并回车, 能访问到 nginx 的欢迎页面。</p>
<h4 id="申请-Let’s-Encrypt-的-ssl-证书"><a href="#申请-Let’s-Encrypt-的-ssl-证书" class="headerlink" title="申请 Let’s Encrypt 的 ssl 证书"></a>申请 Let’s Encrypt 的 ssl 证书</h4><pre class=" language-shell"><code class="language-shell">cd
# 切换工作路径到用户文件夹

# CentOS 选手:
yum -y install certbot

# Ubuntu, Debian 选手:
apt -y install certbot

# 请复制下面一整段命令将其粘贴到一个你喜欢的文本编辑器上, 不要用 Windows 记事本
certbot certonly --manual \
-d *.example.com \
-d example.com --agree-tos \
--manual-public-ip-logging-ok --preferred-challenges \
dns-01 --server https://acme-v02.api.letsencrypt.org/directory
# 将文本编辑器上的这段命令里的第二行和第三行的 example.com 修改成你自己的域名
# 然后, 将编辑器上的这段命令复制下来, 粘贴到服务器的终端执行</code></pre>
<p>然后, 它会自动安装一些依赖, 安装完毕后它会要求你输入你的邮箱。<br><del>( <strong>输你自己的 ! wdnmd</strong> )</del></p>
<p>输入完邮箱, 它会询问你是否同意它往你的邮箱里发小广告, 建议回答 no 。</p>
<p>随后, 它会要求你给你的域名添加一条 txt 记录 ( 这一步是为了验证域名的所有权 ) , 你需要在域名控制台添加, 你会在你的服务器的终端看到以下内容 :</p>
<pre class=" language-yaml"><code class="language-yaml">Please deploy a DNS TXT record under the name 
_acme<span class="token punctuation">-</span>challenge.example.com with the following value<span class="token punctuation">:</span> 

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 

Before continuing<span class="token punctuation">,</span> verify the record is deployed.</code></pre>
<p>注意此处的 example.com 应为你自己的域名</p>
<p>此处应该这样添加:<br>类型: txt , 主机记录: _acme-challenge , 记录值: <code>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code> </p>
<p>回终端后按下回车, 会要求进行第二次验证, 按照这个方法再次验证一次就行。</p>
<p>成功之后, 你服务器目录下的 <code>/etc/letsencrypt/live/你的域名</code> 下会生成一些文件, 其中 <code>fullchain.pem</code> 是你的证书, <code>privkey.pem</code> 是你的私钥。</p>
<h4 id="配置-nginx"><a href="#配置-nginx" class="headerlink" title="配置 nginx"></a>配置 nginx</h4><p>源码运行的 yobot 的配置示例</p>
<pre><code>server {
  listen 80;
  listen [::]:80;
  server_name example.com;
  rewrite ^(.*)$ https://$server_name$request_uri;
}

server {
  listen 443 ssl http2;
  listen [::]:443 ssl http2;

  ssl_stapling on;
  ssl_stapling_verify on;

  ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
  ssl_ciphers &#39;AES128+EECDH:AES128+EDH:!aNULL&#39;;

  ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
  ssl_session_cache shared:SSL:10m;

  resolver 8.8.4.4 8.8.8.8 valid=300s;
  resolver_timeout 10s;

  ssl_prefer_server_ciphers on;
  # ssl_dhparam /etc/letsencrypt/live/dhparam.pem;

  add_header Strict-Transport-Security max-age=63072000;
  add_header X-Frame-Options DENY;
  add_header X-Content-Type-Options nosniff;

  server_name example.com;

  if ($http_user_agent ~* &quot;qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot&quot;)
    {
      return 403;
    }

  location /
  {
    proxy_pass http://localhost:9222;
    proxy_set_header X-Real-IP $remote_addr;
  }

  location /yobot/assets/ {
    alias ~/pcrbot/yobot/src/client/public/static/; 
    expires 30d;
  }

  location /yobot/output/ {
    alias ~/pcrbot/yobot/src/client/yobot_data/output/;
    charset utf-8;
    expires 30d;
  }

  error_page   500 502 503 504  /50x.html;
  location = /50x.html {
      root   html;
  }
}</code></pre><p>修改 nginx 的配置文件</p>
<pre><code>vim /usr/local/nginx/conf/nginx.conf</code></pre><p>需将这个配置文件的内容复制粘贴到 <code>nginx.conf</code> 的第八十一行, 其中的 <code>example.com</code>修改为你自己的域名。</p>
<p>注意 <code>nginx.conf</code> 是 nginx 的主配置文件, 如果你不知道其各项参数的含义, 不要做多余的修改。建议在修改前对这个文件进行备份。</p>
<p>重启 nginx 使其生效</p>
<pre class=" language-shell"><code class="language-shell">nginx -s reload</code></pre>
<p>修改 yobot 的配置文件</p>
<pre class=" language-shell"><code class="language-shell">vim ~/pcrbot/yobot/src/client/yobot_data/yobot_config.json

# public_adress 字段的值修改为 https://example.com/

# 此处 example.com 替换成你自己的域名</code></pre>
<h4 id="验证反向代理"><a href="#验证反向代理" class="headerlink" title="验证反向代理"></a>验证反向代理</h4><p>浏览器访问 <code>https://example.com/</code> 应访问到 yobot 的 homepage</p>
<h4 id="再次提高安全性"><a href="#再次提高安全性" class="headerlink" title="再次提高安全性"></a>再次提高安全性</h4><p>修改 yobot 的配置文件, 仅允许本机监听</p>
<pre class=" language-shell"><code class="language-shell">vim ~/pcrbot/yobot/src/client/yobot_data/yobot_config.json
# HOST 字段的值修改为 127.0.0.1
# 如果你没有做好反向代理的工作, 请不要修改 !</code></pre>
<h3 id="获取-cq-picsearcher-bot"><a href="#获取-cq-picsearcher-bot" class="headerlink" title="获取 cq-picsearcher-bot"></a>获取 cq-picsearcher-bot</h3><p>这个项目与公主连结并无关系, 但是功能实在优秀, 用户可以根据自己的需要选择安装。</p>
<h4 id="安装-nodejs"><a href="#安装-nodejs" class="headerlink" title="安装 nodejs"></a>安装 nodejs</h4><pre class=" language-shell"><code class="language-shell"># CentOS用户请执行 :
curl -sL https://rpm.nodesource.com/setup_12.x | bash - 
yum -y install nodejs

# Ubuntu , Debian 用户请执行 :
curl -sL https://deb.nodesource.com/setup_12.x | bash - 
apt -y install nodejs

# 不建议安装更高版本的 nodejs </code></pre>
<h4 id="安装-cq-picsearcher-bot"><a href="#安装-cq-picsearcher-bot" class="headerlink" title="安装  cq-picsearcher-bot"></a>安装  cq-picsearcher-bot</h4><pre class=" language-shell"><code class="language-shell">cd
# 切换工作路径到用户文件夹

git clone https://github.com/Tsuk1ko/cq-picsearcher-bot.git
# clone 仓库

cd cq-picsearcher-bot
# 切换工作路径

npm install -g yarn
# 使用 npm 全局安装 yarn
# 然后 npm 就可以爪巴了

# yarn 切换到国内源
yarn config set registry https://registry.npm.taobao.org --global
yarn config set disturl https://npm.taobao.org/dist --global
# ↑↑↑ 境外服务器请忽略 ↑↑↑

yarn install
# 使用 yarn 安装依赖, 相比于使用 npm 节约了亿点点时间

cp config.default.json config.json
# 复制 config.default.json 并将其命名为 config.json

vim config.json
# 修改配置文件</code></pre>
<h4 id="修改-cqps-的配置文件"><a href="#修改-cqps-的配置文件" class="headerlink" title="修改 cqps 的配置文件"></a>修改 cqps 的配置文件</h4><p>必须设置的项 : </p>
<ul>
<li>第十五行的 <code>admin</code> 字段修改为你自己的 QQ 号 ( 做主人 ) 。</li>
<li>在 <a href="https://saucenao.com" target="_blank" rel="noopener">https://saucenao.com</a> 创建账号, 并在 <a href="https://saucenao.com/user.php?page=search-api" target="_blank" rel="noopener">这里</a> 找到你的 api key , 将其填入到配置文件的第一百二十一行的 <code>saucenaoApiKey</code> 里。</li>
</ul>
<p>其余设置项 : 见 <a href="https://github.com/Tsuk1ko/cq-picsearcher-bot/wiki/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener">cqps 作者 神代綺凜 对配置文件的详细介绍</a> 。</p>
<h4 id="启动-cqps"><a href="#启动-cqps" class="headerlink" title="启动 cqps"></a>启动 cqps</h4><pre class=" language-shell"><code class="language-shell">cd ~/cq-picsearcher-bot
# 切换工作路径

yarn start
# 启动 cqps</code></pre>
<h4 id="配置正向-ws"><a href="#配置正向-ws" class="headerlink" title="配置正向 ws"></a>配置正向 ws</h4><p>修改 <code>~/go-cqhttp/config.yml</code> , 在 <code>servers</code> 里添加以下内容</p>
<pre class=" language-yml"><code class="language-yml">  - ws:
      host: 127.0.0.1
      port: 6700
      middlewares:
        <<: *default</code></pre>
<p>重启 go-cqhttp</p>
<h4 id="验证安装-1"><a href="#验证安装-1" class="headerlink" title="验证安装"></a>验证安装</h4><p>bot 会主动联系你 ( 笑 ) 。</p>
<h3 id="安装更多功能"><a href="#安装更多功能" class="headerlink" title="安装更多功能"></a>安装更多功能</h3><p>访问 <a href="https://github.com/pcrbot/HoshinoBot-plugins-index" target="_blank" rel="noopener">https://github.com/pcrbot/HoshinoBot-plugins-index</a> 寻找你想要的插件, 并按照说明添加即可。</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>如果不愿意折腾的话可以忽略这一部分。。</p>
<h3 id="使用-http-协议发图"><a href="#使用-http-协议发图" class="headerlink" title="使用 http 协议发图"></a>使用 http 协议发图</h3><p>默认你已经装好了 nginx , 且未改变过默认配置 ( 如果你在浏览器中访问 &lt;http://你服务器的 ip 地址&gt; 是 nginx 的欢迎页面, 说明你的设置是没问题的 )</p>
<pre class=" language-shell"><code class="language-shell">wget https://pan.dihe.moe/res.tar.gz
# 下载

tar xf res.tar.gz
# 解压

mv res /usr/local/nginx/html
# 移动到网站目录

chmod 777 /usr/local/nginx/html/res -R
# 给可读可写权限</code></pre>
<p>然后修改 hoshino 的 _<em>bot_</em>.py :</p>
<pre class=" language-python"><code class="language-python">RES_DIR <span class="token operator">=</span> r<span class="token string">'/usr/local/nginx/html/res/'</span>

RES_PROTOCOL <span class="token operator">=</span> <span class="token string">'http'</span>

RES_URL <span class="token operator">=</span> <span class="token string">'http://&lt;你服务器的 ip 地址>/res/'</span></code></pre>
<p>重启 Hoshino , 完事。</p>
<h3 id="使用-pm2-运行-go-cqhttp"><a href="#使用-pm2-运行-go-cqhttp" class="headerlink" title="使用 pm2 运行 go-cqhttp"></a>使用 pm2 运行 go-cqhttp</h3><p>先关闭你启动的 go-cqhttp 进程 :</p>
<pre class=" language-shell"><code class="language-shell">screen -r go-cqhttp
# 进入 go-cqhttp 这个 screen

# Ctrl + C 组合键, 终止 go-cqhttp 进程

exit
# 关闭 screen</code></pre>
<p>然后 :</p>
<pre class=" language-shell"><code class="language-shell">yarn global add pm2
# yarn 全局安装 pm2

cd ~/go-cqhttp
# 切换工作路径

pm2 start ./go-cqhttp
# 使用 pm2 守护运行 go-cqhttp</code></pre>
<p>常用命令 : </p>
<pre class=" language-shell"><code class="language-shell">pm2 stop go-cqhttp
# 关闭 go-cqhttp

pm2 restart go-cqhttp
# 重启 go-cqhttp

pm2 log go-cqhttp
# 查看日志</code></pre>
<h2 id="后续维护"><a href="#后续维护" class="headerlink" title="后续维护"></a>后续维护</h2><p>此静态资源包可能 rank 表已经过时, 你可以向其他 bot 索要 rank 表, 并用 xftp 之类的软件将你的图片上传到你的服务器上。</p>
<p>或者使用自动更新卡池, rank 表的插件, 你可以在 pcrbot 的 github 组织中寻找。</p>
<p>如果你需要帮助, 你可以加入 Hoshino 群 , yobot 1 群 , yobot 2 群 , 或者 yobot 5 群, 一般情况下有礼貌的提问都会有人帮助你解决。</p>
<h2 id="编写功能"><a href="#编写功能" class="headerlink" title="编写功能"></a>编写功能</h2><p>如果你没有学过 Python , 请先阅读 <a href="https://www.liaoxuefeng.com/wiki/1016959663602400" target="_blank" rel="noopener">廖雪峰的 Python3 教程</a> 至 异步 IO 中的 <code>协程</code> 一节。</p>
<p>如果你学过 Python , 请阅读 <a href="https://github.com/pcrbot/hoshinobot-development-documentation" target="_blank" rel="noopener"> HoshinoBot 开发文档 ( 社区版 ) </a> 。</p>
<h2 id="加入我们"><a href="#加入我们" class="headerlink" title="加入我们"></a>加入我们</h2><p>如果你希望为社区贡献代码, 你可以熟悉 git 的使用后, 加入 <a href="https://github.com/pcrbot" target="_blank" rel="noopener">pcrbot 的 github 组织</a> 。</p>
<p>如果你想加入我们, 你可以在 <a href="https://github.com/pcrbot/join-us" target="_blank" rel="noopener">这个仓库</a> 里提交一个 issue, 随后在与 GitHub 关联的邮箱里查看邀请。</p>
<h2 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h2><p>本项目需致谢 <a href="https://github.com/Adpex" target="_blank" rel="noopener">Adpex</a>, <a href="https://github.com/AkiraXie" target="_blank" rel="noopener">Aspirin</a> <a href="https://github.com/Lancercmd" target="_blank" rel="noopener">Lancercmd</a>, <a href="https://github.com/Ice-Cirno" target="_blank" rel="noopener">Ice-Cirno</a>, <a href="https://github.com/ishkong" target="_blank" rel="noopener">ishkong</a>, <a href="https://github.com/kkbllt" target="_blank" rel="noopener">thgsohack</a>, <a href="https://github.com/WenyiDong" target="_blank" rel="noopener">WenyiDong</a>, <a href="https://github.com/111234567890" target="_blank" rel="noopener">yoshino</a>, <a href="https://github.com/yuudi" target="_blank" rel="noopener">yuudi</a> 等人。</p>

      </section>

      <section class="article-footer">
        
      </section>

      <section class="article-navs">
        
<nav class="card-container card-article-nav">
  <div class="card-list">
    
      <div id="article-nav-newer" class="card-item img">
        <article>
          
            <div class="card-cover" style="background-image: url(/images/banner-kasumi.jpg)"></div>
          
          <a class="card-link article-nav-link" href="/yumemi_bot/"></a>
          <strong class="article-nav-caption">Newer</strong>
          <p class="article-nav-title">
            
              yumemi_bot
            
          </p>
        </article>
      </div>
    
    
      <div id="article-nav-older" class="card-item img">
        <article>
          
            <div class="card-cover" style="background-image: url(/images/banner-chieru.jpg)"></div>
          
          <a class="card-link article-nav-link" href="/HoshinoBot-plugins-index/"></a>
          <strong class="article-nav-caption">Older</strong>
          <p class="article-nav-title">
            
              HoshinoBot 作品索引
            
          </p>
        </article>
      </div>
    
  </div>
</nav>

      </section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
     
    <p>&copy; 2021 <a href="/" target="_blank">pcrbot</a></p>

    

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>
    
    <!--
    <div class="footer-container__texts">
      <p>ヽ｀、ヽ｀｀、ヽ｀ヽ｀、、ヽ｀ヽ、ヽ｀、ヽ｀｀、ヽ、｀｀、、ヽ｀ヽ、｀｀、、ヽ｀ヽ、｀ヽ、｀ヽ、｀ヽ</p>
      <p>｀、ヽ｀｀、ヽ、｀｀｀、｀、ヽ🌙｀｀、｀ヽ｀ヽ、ヽ｀、ヽ｀ヽ、ヽ｀、ヽ｀ヽ、ヽ｀、ヽ｀｀、｀ヽ、｀</p>
      <p>｀、｀｀、｀、ヽ｀｀、、ヽヽ｀、｀ヽ｀ヽ、ヽ｀、ヽ｀ヽ、ヽ｀、、、ヽヽ、｀｀、、ヽ｀、ヽ｀｀、ヽ｀ヽ｀</p>
      <p>ヽ｀、｀｀、｀、ヽ｀｀、、ヽヽ｀、｀、、ヽヽ、｀Time waits for on one 🍓｀、、ヽ｀、ヽ｀｀、ヽ｀ヽ｀</p>
      <p>｀ヽ｀｀、ヽ｀ヽ｀、、ヽ｀ヽ｀ヽ｀ヽ、ヽ｀、ヽ｀｀、ヽ、｀｀、、ヽ｀ヽ、｀｀、、ヽ｀ヽ、｀ヽ、｀ヽ、｀ヽ</p>
    </div>
    -->
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
  <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
  <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
</svg> 
  </div>

  
  




<!-- waterfall 瀑布流 start -->

<script src="/lib/waterfall.min.js"></script>

<script type="text/javascript">

const waterfalls = document.querySelectorAll(".waterfall-container");

if (waterfalls && waterfalls.length > 0) {
  waterfalls.forEach((waterfall, index) => {
    let cls = "waterfall-container-" + index;
    waterfall.classList.add(cls);
    initWaterfall(cls, waterfall);
  });
}

function initWaterfall(selector, el) {
  const options = {};
  if (Object.keys(el.dataset).length > 0) {
    for (let k in el.dataset) {
      options[k] = el.dataset[k];
    }
  }
  waterfall(`.${selector}`, options);
}
</script>
<!-- waterfall 瀑布流 end -->


  <!-- zoom start -->
  
<script src="/lib/zoom.min.js"></script>

  <script type="text/javascript">
    document.querySelector(".article-content") && zoom(".article-content");
  </script>
  <!-- zoom end -->
  



  


  


  




<script src="/js/script.js"></script>


  
  <!-- 尾部用户自定义相关内容 -->
</body>
</html>